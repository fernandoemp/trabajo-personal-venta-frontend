<div class="bg-color-fondo pb-5 pt-3">
    <div class="container register py-3 fadeInDown borde-sombra bordes">
        <div class="row justify-content-center">
            <div class="col-md-3 col-xl-2 register-left mt-2 text-center mt-5 pt-2 mx-auto">
                <p class="h3">Panel de Usuarios</p>
                <img src="./../../../../assets/alta_usuario/logo_add_usuario.png" class="img-fluid" alt="usuario" />
                <p class="h4">Usuario: {{loginService.userLogueadoDisplay}}</p>
                <p class="h5">Perfil: {{loginService.userPerfil}}</p>
            </div>
            <div class="col-md-9 col-xl-10 register-right">
                <div class="row justify-content-end">
                    <div class="col-auto">
                        <ul class="nav nav-tabs nav-justified mt-2" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Sign Up</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Manage</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                        <h2 class="register-heading mt-2 pt-4 text-center">Registro de Usuarios</h2>
                        <form #registrousuarios="ngForm" autocomplete="off" class="row register-form mt-3 justify-content-center" (ngSubmit)="onSubmit(registrousuarios)" method="POST">
                            <div class="col-md-8 col-lg-7 col-xl-6">
                                <div class="form-group">
                                    <input id="usuario" class="form-control" pattern="[A-Za-z0-9._%+-]{3,}@[a-zA-Z]{3,}([.]{1}[a-zA-Z]{2,}|[.]{1}[a-zA-Z]{2,}[.]{1}[a-zA-Z]{2,})" type="email" required #user="ngModel" placeholder="E-MAIL Propietario" [(ngModel)]="usuario.usuario" name="usuario"
                                        [ngClass]="{ 'is-invalid':  user.invalid && (user.dirty || user.touched) }" />
                                    <div *ngIf="user.invalid && (user.dirty || user.touched)" class="invalid-feedback strong col-auto">
                                        <div *ngIf="user.errors.required">
                                            Ingrese un email
                                        </div>
                                        <div *ngIf="user.errors.pattern">
                                            Ingrese un email válido
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="password" class="form-control" id="password" name="password" minlength="6" required pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$" #pass="ngModel" placeholder="Contraseña *" [(ngModel)]="usuario.password" [ngClass]="{ 'is-invalid':  pass.invalid && (pass.dirty || pass.touched) }"
                                    />
                                    <div *ngIf="pass.invalid && (pass.dirty || pass.touched)" class="invalid-feedback strong col-auto">
                                        <div *ngIf="pass.errors.required">
                                            Ingrese una contraseña
                                        </div>
                                        <div *ngIf="pass.errors.minlength">
                                            La contraseña debe tener como minimo 6 caracteres
                                        </div>
                                        <div *ngIf="pass.errors.pattern">
                                            La contraseña debe tener 1 letra mayuscula, 1 letra minuscula y 1 numero
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="password" class="form-control" id="password2" name="password2" minlength="6" required pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$" placeholder="Repita la contraseña *" [(ngModel)]="passwordAux" [ngClass]="{ 'border-danger': verificarPassword() == false && pass.touched}"
                                    />
                                </div>
                                <div class="form-group" *ngIf="loginService.userPerfil == 'Administrador'">
                                    <select class="form-control" name="perfil" id="perfil" [(ngModel)]="usuario.perfil" required>
                                <option class="hidden" value="undefined" disabled>Seleccione un Perfil</option>
                                <option value="Administrador">ADMINISTRADOR</option>
                                <option value="Administrativo">Administrativo</option>
                                <option value="Propietario">Propietario</option>
                            </select>
                                </div>
                                <div class="form-group">
                                    <div class="btn-group btn-group-toggle efectoScale" data-toggle="buttons">
                                        <button type="button" class="btn btn-cuenta-Activa text-light" (click)="seleccionarEstadoCuenta(true)" [ngClass]="{ 'btn-personalizado-Activo': usuario.activo==true }">Cuenta Activa</button>
                                        <button type="button" class="btn btn-cuenta-Activa text-light" (click)="seleccionarEstadoCuenta(false)" [ngClass]="{ 'btn-personalizado-Activo': usuario.activo==false }">Cuenta Inactiva</button>
                                    </div>
                                </div>
                                <div class="form-group" *ngIf="loginService.userPerfil == 'Administrativo'">
                                    <output type="text" class="form-control" id="peradm" name="peradm">Propietario</output>
                                </div>
                                <div class="form-group row justify-content-center mt-3 efectoScale">
                                    <input type="submit" class="btn btn-lg boton-personalizado" [disabled]="!registrousuarios.valid || verificarPassword() == false" (click)="signUp()" value="Registrar" />
                                    <input type="reset" class="btn btn-lg boton-personalizado mr-2" (click)="limpiarCampos()" value="Cancelar" />
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane fade show row justify-content-start  mr-1 ml-md-0 mr-md-2 pb-0 mb-0" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                        <form class="col-auto mt-2 mb-1 form-inline mx-auto  text-left">
                            <input type="text" placeholder="E-mail" class="form-control" style="width: 40%;" name="search" [(ngModel)]="busqueda">
                            <button *ngIf="loginService.userPerfil == 'Administrador'" type="submit" class="btn botonSmall" (click)="getUsuariosBorrados() ; mostrarBorrados= true"><i class="fas fa-trash-alt"></i></button>
                            <button class="btn botonSmall" (click)="getUsuarios(); mostrarBorrados = false"><i class="fas fa-redo-alt"></i></button>
                        </form>
                        <table class="table table-responsive ml-3 ml-sm-3" [mfData]="usuarios" #mf="mfDataTable" [mfRowsOnPage]="5">
                            <thead class="tabla-encabezado text-light p-1">
                                <tr class="h5">
                                    <th scope="col-auto">
                                        <mfDefaultSorter by="usuario">Usuario</mfDefaultSorter>
                                    </th>

                                    <th scope="col-auto">
                                        <mfDefaultSorter by="perfil">Perfil</mfDefaultSorter>
                                    </th>
                                    <th scope="col-auto">
                                        <mfDefaultSorter by="activo">Cuenta</mfDefaultSorter>
                                    </th>
                                    <th scope="col-auto">

                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let usuario of mf.data | filterUsuario: busqueda" [ngClass]="{'usuario-borrado': usuario.borrado == true}">
                                    <td scope="row">{{ usuario.usuario }}</td>
                                    <td>{{ usuario.perfil | uppercase }}</td>
                                    <td>{{ usuario.activo ? 'ACTIVA': 'BLOQUEADA'}}</td>
                                    <td>
                                        <div class="hover px-3 py-2">
                                            <span>Acciones</span>
                                            <a class="social-link px-2" (click)="verModal(cambiarpassword, usuario)">
                                                <i class="fas fa-key"></i>
                                            </a>
                                            <a class="social-link  px-2" (click)="verModal(modificar, usuario)">
                                                <i class="far fa-edit"></i>
                                            </a>
                                            <a *ngIf="usuario.borrado == false" class="social-link px-2" (click)="verModal(borrar, usuario)">
                                                <i class="fas fa-trash-alt"></i>
                                            </a>
                                            <a *ngIf="loginService.userPerfil == 'Administrador' && usuario.borrado == true" class="social-link px-2" (click)="verModal(restaurar, usuario)">
                                                <i class="fas fa-trash-restore-alt"></i>
                                            </a>
                                            <a *ngIf="loginService.userPerfil == 'Administrador' && usuario.borrado == true" class="social-link px-2" (click)="verModal(borrardefinitivamente, usuario)">
                                                <i class="fas fa-user-minus"></i>
                                            </a>
                                            <a class="social-link px-2" (click)="getPropietarioByUsuario(usuario); verModal(datospropietario, usuario)">
                                                <i class="fas fa-search"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="">
                                        <mfBootstrapPaginator class="" [rowsOnPageSet]="[5,10,25]"></mfBootstrapPaginator>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <!--MODALS-->
                    <div class="col-10">
                        <ng-template #modificar let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal text-light ">
                                    <h4 class="modal-title w-100 font-weight-bold">Modificar Usuario?</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos(); modal.close()">
                            <span aria-hidden="true">&times;</span>
                          </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <div class="md-form mb-5">
                                        <label data-error="wrong" data-success="right" for="orangeForm-name"><i class="fas fa-user prefix grey-text"></i> Usuario</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.usuario}}</output>
                                    </div>
                                    <div class="md-form mb-4">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-user-cog"></i> Perfil</label>
                                        <select class="form-control" name="perfil" id="perfil" [(ngModel)]="usuario.perfil">
                                <option class="hidden" value="undefined"  selected disabled>Seleccione un Perfil</option>
                                <option value="Administrador" >ADMINISTRADOR</option>
                                <option value="Administrativo" >Administrativo</option>
                                <option value="Propietario">Propietario</option>
                            </select>
                                    </div>
                                    <div class="md-form mb-5">
                                        <label data-error="wrong" data-success="right" for="orangeForm-email"><i class="fas fa-unlock-alt"></i> Estado de Cuenta</label><br>
                                        <div class="form-group">
                                            <div class="btn-group btn-group-toggle efectoScale" data-toggle="buttons">
                                                <button type="button" class="btn btn-dark text-light" (click)="seleccionarEstadoCuenta(true)" [ngClass]="{ 'btn-Personalizado-Activo-Mod': usuario.activo==true }">Activada</button>
                                                <button type="button" class="btn btn-dark text-light" (click)="seleccionarEstadoCuenta(false)" [ngClass]="{ 'btn-Personalizado-Activo-Mod': usuario.activo==false }">Bloqueada</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-dark" (click)="updateUsuario(); modal.close()">Modificar</button>
                                    <button class="btn btn-dark" (click)="limpiarCampos(); modal.close()">Cancelar</button>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                    <div class="col-10">
                        <ng-template #cambiarpassword let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal text-light">
                                    <h4 class="modal-title w-100 font-weight-bold">Modificar Contraseña?</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos(); modal.close()">
                                        <span aria-hidden="true">&times;</span>
                             </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <form #formcambiarpassword="ngForm">
                                        <div class="md-form mb-5">
                                            <div class="form-group">
                                                <label data-error="wrong" data-success="right" for="defaultForm-email"><i class="fas fa-lock prefix grey-text"></i> Ingrese nueva contraseña</label>
                                                <input type="password" class="form-control" id="password" name="password" minlength="6" required pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$" #pass="ngModel" placeholder="Contraseña *" [(ngModel)]="usuario.password" [ngClass]="{ 'is-invalid':  pass.invalid && (pass.dirty || pass.touched) }"
                                                />
                                                <div *ngIf="pass.invalid && (pass.dirty || pass.touched)" class="invalid-feedback strong col-auto">
                                                    <div *ngIf="pass.errors.required">
                                                        Ingrese una contraseña
                                                    </div>
                                                    <div *ngIf="pass.errors.minlength">
                                                        La contraseña debe tener como minimo 6 caracteres
                                                    </div>
                                                    <div *ngIf="pass.errors.pattern">
                                                        La contraseña debe tener 1 letra mayuscula, 1 letra minuscula y 1 numero
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="md-form mb-4">
                                            <div class="form-group">
                                                <label data-error="wrong" data-success="right" for="defaultForm-pass"><i class="fas fa-lock prefix grey-text"></i> Repita la contraseña</label>
                                                <input type="password" class="form-control" id="password2" name="password2" minlength="6" required pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$" placeholder="Repita la contraseña *" [(ngModel)]="passwordAux" [ngClass]="{ 'border-danger': verificarPassword() == false && pass.touched}"
                                                />
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-dark" [disabled]="!formcambiarpassword.valid || !verificarPassword()" (click)="updatePasswordUsuario(); modal.close()">Cambiar</button>
                                    <button class="btn btn-dark" (click)="limpiarCampos(); modal.close()">Cancelar</button>
                                </div>
                            </div>
                        </ng-template>
                    </div>

                    <div class="col-10">
                        <ng-template #borrar let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal">
                                    <h4 class="modal-title w-100 font-weight-bold text-light">Borrar Usuario?</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos(); modal.close()">
                          <span aria-hidden="true">&times;</span>
                        </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <div class="md-form mb-5">
                                        <label data-error="wrong" data-success="right" for="orangeForm-name"><i class="fas fa-user prefix grey-text"></i> Usuario</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.usuario}}</output>
                                    </div>
                                    <div class="md-form mb-4">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-user-cog"></i> Perfil</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.perfil}}</output>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-dark" (click)="deleteUsuario(); modal.close()">Borrar</button>
                                    <button class="btn btn-dark" (click)="limpiarCampos(); modal.close()">Cancelar</button>
                                </div>

                            </div>
                        </ng-template>
                    </div>

                    <div class="col-10">
                        <ng-template #borrardefinitivamente let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal text-light">
                                    <p class="modal-title w-100 font-weight-bold text-danger h3">Borrar Usuario Definitivamente?</p>

                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos(); modal.close()">
                        <span aria-hidden="true">&times;</span>
                      </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <p class="text-danger h5 text-center">Esta acción no se puede deshacer.</p>
                                    <div class="md-form mb-5">
                                        <label data-error="wrong" data-success="right" for="orangeForm-name"><i class="fas fa-user prefix grey-text"></i> Usuario</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.usuario}}</output>
                                    </div>
                                    <div class="md-form mb-4">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-user-cog"></i> Perfil</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.perfil}}</output>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-danger" (click)="deleteUsuarioDefinitivamente(); modal.close()">ELIMINAR</button>
                                    <button class="btn btn-dark" (click)="limpiarCampos(); modal.close()">Cancelar</button>
                                </div>

                            </div>
                        </ng-template>
                    </div>

                    <div class="col-10">
                        <ng-template #restaurar let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal text-light">
                                    <h4 class="modal-title w-100 font-weight-bold">Restaurar Usuario?</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos(); modal.close()">
                        <span aria-hidden="true">&times;</span>
                      </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <div class="md-form mb-5">
                                        <label data-error="wrong" data-success="right" for="orangeForm-name"><i class="fas fa-user prefix grey-text"></i> Usuario</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.usuario}}</output>
                                    </div>
                                    <div class="md-form mb-4">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-user-cog"></i> Perfil</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{usuario.perfil}}</output>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-dark" (click)="restaurarUsuario(); modal.close()">Restaurar</button>
                                    <button class="btn btn-dark" (click)="limpiarCampos(); modal.close()">Cancelar</button>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                    <div class="col-10">
                        <ng-template #datospropietario let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal text-light">
                                    <h4 class="modal-title w-100 font-weight-bold">Datos del Propietario</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos(); modal.close()">
                               <span aria-hidden="true">&times;</span>
                              </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <div class="md-form mb-2">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-portrait"></i> DNI</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{propietario.dni}}</output>
                                    </div>
                                    <div class="md-form mb-2">
                                        <label data-error="wrong" data-success="right" for="orangeForm-name"><i class="fas fa-user-tie"></i> Apellido</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{ propietario.apellido }}</output>
                                    </div>
                                    <div class="md-form mb-2">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-user-tie"></i> Nombres</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{propietario.nombres}}</output>
                                    </div>

                                    <div class="md-form mb-2">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-at"></i> E-Mail</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{propietario.email}}</output><button class="btn btn-outline-dark btm-sm mt-1" (click)="abrirModal(mensajeModal)"><i class="fas fa-envelope-open-text"></i></button>
                                    </div>
                                    <div class="md-form mb-2">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-mobile-alt"></i> Telefono</label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{propietario.telefono}}</output>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-dark" (click)="limpiarCampos(); modal.close()">Cerrar</button>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                    <div class="col-8">
                        <ng-template #mensajeModal let-modal class="modal">
                            <div class="modal-content fadeIn">
                                <div class="modal-header text-center encabezado-modal text-light">
                                    <h4 class="modal-title w-100 font-weight-bold">Mensaje Privado</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="limpiarCampos();modal.close()">
                           <span aria-hidden="true">&times;</span>
                          </button>
                                </div>
                                <div class="modal-body mx-3">
                                    <div class="md-form mb-4">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-portrait"></i> Para </label>
                                        <output type="text" id="orangeForm-name" class="form-control validate">{{ propietario.email }}</output>
                                    </div>
                                    <div class="md-form mb-5">
                                        <label data-error="wrong" data-success="right" for="orangeForm-name"><i class="fas fa-user-tie"></i> Asunto </label>
                                        <input type="text" id="orangeForm-name" class="form-control validate" [(ngModel)]="mensaje.asunto">
                                    </div>
                                    <div class="md-form mb-4">
                                        <label data-error="wrong" data-success="right" for="orangeForm-pass"><i class="fas fa-user-tie"></i> Mensaje </label>
                                        <textarea type="text" rows="4" id="orangeForm-name" class="form-control validate" [(ngModel)]="mensaje.texto"></textarea>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button type="submit" class="btn btn-outline-dark btn-light m-1" (click)="enviarMensaje(); modal.close()">Enviar</button>
                                    <button type="button" class="btn btn-outline-dark btn-light m-1" (click)="limpiarCampos();modal.close()">Cancelar</button>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
